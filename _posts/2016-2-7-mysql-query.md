---
layout: post
title: mysql 쿼리 최적화
cover: cover.jpg
---


* * *
<br></br>

# mysql 쿼리 최적화

라이센스적 측면도 있고 트레이드 오프적 측면에서 보면 꽤 괜찮은 mysql (적은 오버헤드,비용,등등)

실제로 사내에서의 서비스 개발에서도 mysql을 앞으로 많이 사용한다고 한다.(이전에는 다른 db를 썼었지만)

물론 사내에서 데이터베이스 관련한 검수를 받을 수 있는 것도 사실이지만 어느 정도 쿼리에 대한 최적화를 시행해야하는 것은 당연히
개발자의 의무라고 생각한다. 

물론 이제까지 진행했던 프로젝트의 경우 규모가 작기 때문에 아직까지 성능적인 부분에서 많은 이슈가 없었지만 
추후를 생각해보면 쿼리의 최적화나 인덱싱에 관련된 내용을 고려하는 것이 좋다. 

이를 위해 mysql에서는 쿼리의 최적화를 실행 정보를 확인할 수 있도록 지원한다. (explain)

 그 것보다 먼저 어떤 쿼리가 지연되고 있다던가 최적화가 안되어있다던가를 아는 것이 중요하다. 
 사실 사용되는 전 쿼리에 대해 정보를 저장하고 그 실행횟수와 실행 시간의 비율적 측면으로 통계 정보를 얻을 수 있는 다른 DBMS(예를 들어 오라클?)
 과 비교하면 얻을 수 있는 정보가 한정적인 것 같다.
 
 이 부분에 대해서 언급하는 이유는 mysql에서 제공하는 slow_query_log의 경우 초단위를 기준으로 실행시간을 넘는 쿼리에 대해서 로깅을 제공한다.
 이는 얼핏보면 최적화에 관련된 유용한 정보일 수도 있지만 실제로 서비스의 경우에는 단위시간당 상대적으로 시간이 짧은 쿼리를 많이 로드하는 경우를 찾지 못한다.
 
 즉 쿼리의 최적화는 느린 쿼리뿐만 아니라 전체 쿼리에 대한 상대적인 비율을 판단하고 과부하를 찾아야하는 것이 추가로 필요하다.
이런 부분에 있어서 고민한 커스텀 패치를 개발하는 경우도 있는 것 같지만 일단 기본 mysql 스펙에 있는 것은 아니다.(이 부분은 상용판인 오라클에서는 공식 지원이 되어있다.)

[https://plus.google.com/108517558980148150657/posts/NBdhD8Abm7Z](https://plus.google.com/108517558980148150657/posts/NBdhD8Abm7Z)
(커스텀 패치와 관련된 추가 정보를 보고 싶다면)

그럼 일단 본론으로 돌아와 기본적인 mysql에서의 슬로우 쿼리 찾는 법에 대해서는 
[http://zetawiki.com/wiki/MySQL_%EC%8A%AC%EB%A1%9C%EC%9A%B0_%EC%BF%BC%EB%A6%AC_%EB%A1%9C%EA%B7%B8_%EC%84%A4%EC%A0%95](http://zetawiki.com/wiki/MySQL_%EC%8A%AC%EB%A1%9C%EC%9A%B0_%EC%BF%BC%EB%A6%AC_%EB%A1%9C%EA%B7%B8_%EC%84%A4%EC%A0%95)
을 참고하면 된다.

혹시나 윈도우 로컬에서 테스팅을 해보고 싶다면 위를 참고한 다음에 서버가 설치된 경로(win10이라면 /programData/Mysql/MySQL Server {version}/)에

Data 폴더를 들어가보면 해당 슬로우 쿼리 로그 파일이 디폴트로 지정되어 있을 확률이 크다.(변경하고 싶다면 위의 방법을 참고하여 my.cnf를 수정하면 된다.)
 
위의 정보를 통해 슬로우 쿼리에 대해서 찾을 수 있고 이 슬로우 쿼리에 대해서 explain을 실행해보면 된다.

explain에 대한 설명과 해당 결과에 대한 해석 부분은 아래에서 참고하면 된다.
[http://dev.mysql.com/doc/refman/5.7/en/using-explain.html](http://dev.mysql.com/doc/refman/5.7/en/using-explain.html)

이를 통해 인덱싱이 제대로 안되어 있거나 불필요한 카티시안 곱이 이루어지고 있는 경우에 대해서 알 수 있고 해결 할 수 있다.

일단 여기까지가 방법론까지인데 실제 적용하는 것은 또 다른 문제이기 때문에 실제 프로젝트를 실행하면서 문제가 있는 경우 
문제를 찾는 것과 해결하는 것은 나중에 따로 포스트 하고자 한다.

> 추가 : 오라클보다 확실히 지원하는 기능이 작은 것 같다. 사용 패턴 분석과 같은 기능이 보이질 않는다.(찾지 못한 것일 수도)
> 추가2: explain format=json "쿼리~" 식으로 실행하면 json 형태로 결과를 볼 수 있다. 다른 지원 기능과 연동도 편하고 실제 분석할때도 더 많은 정보를 볼 수 있다.
